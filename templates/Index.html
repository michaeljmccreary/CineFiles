{% extends "base.html" %} {% block content %}
<!-- DOM-BASED XSS Vulnerability - Reads from URL and displays without sanitization -->
<div id="welcome-message"></div>
<script>
  // DOM-based XSS: Reading URL parameter and inserting directly into DOM
  // to test dom-based xss, use a URL like: http://localhost:5000/?message=<img src=x onerror=alert('pwned')>
  const urlParams = new URLSearchParams(window.location.search);
  const message = urlParams.get("message");
  if (message) {
    // VULNERABLE: Using innerHTML with unsanitized user input
    document.getElementById("welcome-message").innerHTML = message;
  }
</script>

<h1>Welcome to CineFiles</h1>
<p>Your personal movie review and discussion website</p>
{% if 'username' in session %}
<p>
  Hello, {{ session['username'] }}! <a href="{{ url_for('logout') }}">Logout</a>
</p>
{% endif %}

<!-- Display trending movies fetched from the TMDB API -->
<hr />
<h2>Top 10 movies at the moment</h2>

<!-- Adding a Carosel to rotate through movies -->
<div id="Carosel" class="carosel">
  {% for movie in movies %}
  <div class="carosel-item">
    {% if movie.poster_path %}
    <img
      src="{{ movie.poster_path }}"
      alt="{{ movie.title }} Poster"
      class="carosel-poster"
    />
    {% else %}
    <div class="no-poster">No Movie Poster Available for {{ movie.title }}</div>
    {% endif %}

    <div class="carosel-details">
      <h3>{{ movie.title }}</h3>
      <p>Release Date: {{ movie.release_date }}</p>
      <p>Rating: {{ movie.vote_average }} ({{ movie.vote_count }} votes)</p>
      <p>{{ movie.overview }}</p>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Carosel Navigation Buttons -->
<div class="carosel-nav">
  <button id="prevBtn" class="carosel-btn">Previous</button>
  <button id="nextBtn" class="carosel-btn">Next</button>
</div>
<!-- Calling the javascript file to use the carosel buttons -->
<script src="{{ url_for('static', filename='script.js') }}"></script>

{% endblock %}
